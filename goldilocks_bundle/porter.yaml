# Optional indicator of the resource type of this file
schemaType: Bundle

# Version of the porter.yaml schema used by this file.
schemaVersion: 1.0.1

# Name of the bundle
name: porter-gold

# Version of the bundle. Change this each time you modify a published bundle.
version: 1.0.0

description: "Bundle for installing Goldilocks utility that can help you identify a starting point for resource requests and limits"

# Registry where the bundle is published 
registry: "dejanualex"

#CHECK THIS https://porter.sh/docs/introduction/concepts-and-components/intro-credentials/
credentials:
  - name: kubeconfig
    path: /home/nonroot/.kube/config

# Declare and optionally configure the mixins used by the bundle
mixins:
  - kubernetes
  - helm3:
      repositories:
        fairwinds-stable:
          url: https://charts.fairwinds.com/stable #helm repo add fairwinds-stable https://charts.fairwinds.com/stable

install:
  - kubernetes:
      description: "Create namespace"
      manifests:
        - cnab/app/manifests/namespace
      wait: true
      surpress-output: false
      outputs:
        - name: namespacename
          resourceType: namespaces
          resourceName: goldilocks
          # -ojsonpath={.metadata.name}
          jsonPath: "$.metadata.name"
  - helm3:
      description: "Install fairwinds goldilocks chart"
      name: goldilocks # RELEASE NAME
      chart: fairwinds-stable/goldilocks
      version: 8.0.2
      namespace: goldilocks

upgrade:
  - kubernetes:
      description: "Upgrade Hello App"
      manifests:
        - cnab/app/manifests/hello
      wait: true

uninstall:
- helm3:
      description: "Uninstall fairwinds goldilocks charts"
      namespace: goldilocks #"${ bundle.outputs.namespacename }"
      chart: fairwinds-stable/goldilocks
      version: 8.0.2
      releases:
        - goldilocks # RELEASE NAME

outputs:
    - name: namespacename
      description: Namespace for goldilocks resources
      type: string
      applyTo:
        - install